<!-- Use this as the structure for your output file. Fill in the sections. -->
## 背景 (Context)

当前需要一个快速验证交易想法的工具。现有的全功能回测框架（如 Backtrader, Zipline）学习曲线陡峭且配置复杂。对于简单的双均线等策略，我们希望有一个“即写即用”的脚本级解决方案。

## 目标与非目标 (Goals / Non-Goals)

**目标 (Goals):**
*   **极简**: 单个 Python 脚本完成所有工作。
*   **快速**: 利用 Pandas 向量化计算，秒级完成回测。
*   **直观**: 直接输出关键指标和资金曲线图。
*   **数据无忧**: 集成 `akshare`，自动下载所需数据。

**非目标 (Non-Goals):**
*   支持复杂的订单类型（限价单、止损单）。
*   支持多标的组合回测（本设计专注于单标的）。
*   实时交易对接。
*   复杂的面向对象设计模式。

## 关键决策 (Decisions)

### 1. 架构模式：过程式脚本 (Procedural Script)
*   **决策**: 放弃类（Class）结构，使用函数（Function）组织代码。
*   **理由**: 用户明确要求“不需要面向对象”。对于百行以内的回测逻辑，函数式更直观，易于修改和调试。
*   **替代方案**: 定义 `Strategy` 基类。虽然扩展性好，但增加了样板代码，违背了“最小回测”的初衷。

### 2. 信号处理：向量化 (Vectorization)
*   **决策**: 使用 Pandas 的列运算生成信号。
*   **理由**: 性能比 `for` 循环高几个数量级，且代码更接近数学公式，易读性强。
*   **实现细节**:
    *   `df['signal']` 存储持仓信号（1或0）。
    *   `df['strategy_ret'] = df['signal'].shift(1) * df['pct_change']` 处理信号滞后，避免未来函数。

### 3. 数据源：AkShare
*   **决策**: 使用 `akshare` 接口。
*   **理由**: 免费、开源、覆盖 A 股/ETF 全面。
*   **缓存策略**: 脚本运行通过 `os.path.exists` 检查本地 CSV，避免重复请求。

## 风险与权衡 (Risks / Trade-offs)

### [风险] 过度简化交易成本
*   **描述**: 向量化回测通常忽略滑点和复杂的冲击成本。
*   **缓解**: 在计算净值时，简单扣除固定比例的交易税费（如双边万分之二），在代码中留出 `cost` 参数。

### [风险] 偷价 (Look-ahead Bias)
*   **描述**:如果不小心使用了当天的收盘价交易（而信号也是基于当天收盘价生成的），会导致回测虚高。
*   **缓解**: 严格执行 `shift(1)` 操作，确保使用 T 日信号交易 T+1 日的涨跌幅。

## 迁移计划 (Migration Plan)

无旧系统迁移。本功能为新增独立脚本。
