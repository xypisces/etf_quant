## Context

当前系统已有完整的事件驱动回测引擎、`Strategy` 基类、风控模块和数据管理层。现有两套策略（MACross、EMA20Pullback）证明了架构可行性。本次扩展旨在丰富策略库并引入研究基础设施。

现有架构约束：
- 策略必须继承 `Strategy` 基类，实现 `on_bar()` + `generate_signal()`
- 回测引擎为单品种事件驱动模型
- 信号类型为 BUY/SELL/HOLD（无做空、无多品种联动）

## Goals / Non-Goals

**Goals:**
- 新增 4 种经典策略，覆盖趋势跟踪、区间交易、动量轮动、均值回归四大范式
- 提供参数优化器（Grid Search + Walk-forward），可系统化搜索最优参数并防止过拟合
- 提供批量回测能力，支持多品种 × 多策略矩阵化回测与对比
- 所有新策略与现有回测引擎完全兼容

**Non-Goals:**
- 不改动回测引擎核心（引擎保持单品种模式，多品种通过外层循环实现）
- 不引入实时数据流（仍为离线回测模式）
- 不实现因子 IC/分组回测等深度因子分析（标注为可选，视进度而定）
- 不做 Jupyter Notebook 集成（留给用户自行使用）

## Decisions

### 1. 策略实现方案

所有策略继承 `Strategy` 基类，逐 bar 递推计算指标，杜绝未来函数。

| 策略     | 核心逻辑                                      | 关键指标        |
| -------- | --------------------------------------------- | --------------- |
| 海龟     | 唐奇安通道突破入场，ATR 倍数止损              | 通道上下轨、ATR |
| 网格     | 价格区间等分 N 格，触及下格线买入、上格线卖出 | 网格线列表      |
| 动量轮动 | 计算各品种动量得分，定期轮动到最强品种        | ROC/斜率得分    |
| 均值回归 | 布林带下轨买入、上轨卖出 + RSI 过滤           | BB、RSI         |

### 2. 动量轮动策略的多品种处理

**问题**：现有引擎为单品种，动量轮动需要跨品种比较。

**方案**：动量轮动不在引擎内实现跨品种联动，而是作为"单品种评分策略"。多品种轮动逻辑在 `batch_runner` 层面实现：
1. 对每个品种独立运行动量策略，输出动量得分时间序列
2. `batch_runner` 汇总所有品种的得分，按策略规则选择持有品种

这样无需改动回测引擎。

### 3. 参数优化器设计

**Grid Search**：对参数空间做笛卡尔积遍历，每组参数运行完整回测。

**Walk-forward 验证**：将数据切分为 N 段（如 5 段），每段分为训练期和测试期。在训练期优化参数，在测试期验证，防止过拟合。

**输出**：按收益率/夏普比排序的参数组合表 + 训练/测试期稳定性评估。

### 4. 批量回测器设计

**输入**：品种列表 × 策略列表 × 参数列表（可选）。

**输出**：统一结果 DataFrame，按品种+策略+绩效指标汇总，支持排序和筛选。复用现有 `ReportWriter` 生成对比报告。

### 5. 目录结构

```
src/strategy/          # 策略模块（现有 + 新增）
├── turtle.py          # 海龟策略
├── grid.py            # 网格交易
├── momentum.py        # 动量轮动
└── mean_reversion.py  # 均值回归

src/research/          # 研究模块（全新）
├── batch_runner.py    # 批量回测
└── optimizer.py       # 参数优化
```

## Risks / Trade-offs

- **[参数爆炸]** → Grid Search 参数空间可能很大。缓解：限制单次优化的参数维度，提供 `max_combinations` 上限
- **[动量轮动简化]** → 单品种模式下无法做真正的组合轮动。缓解：batch_runner 层面实现，但延迟仍较大。真正的组合轮动需要组合级引擎，留待后续
- **[网格策略风险]** → 网格交易在单边行情中可能严重亏损。缓解：通过风控模块的止损机制兜底
- **[Walk-forward 耗时]** → N 段 × M 参数组合 = N×M 次回测。缓解：提供进度条，支持并行（可选）
